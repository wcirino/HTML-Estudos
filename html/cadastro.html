<html>
	<head>
		<meta charset="utf-8">
		<title>Clinica Medica - cadastro beneficiario</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="../css/cadastro.css">
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" 
		integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="  crossorigin="anonymous"></script>
	    <script src="../js/cadastro.js"></script>
    </head>
<body>
	<div class="container">
		<header>
			<nav>
				<div class="nav-container">
						<img id="logo" src="../img/icon-usuario2.png" alt="beneficarioCadastro">
					<!--<i class="fas fa-bars btn-menumobile"></i>-->
					<ul>
						<li><a href="#">Login</a></li>
						<li><a href="#">Cadastre-se</a></li>
						<li><a href="#">Contato</a></li>
					</ul>
				</div>
			</nav>
		</header>
    </div>
    <div class="container-fluid h-100">
        <div>
              <div class="collapse" id="collapseExample">
                <div class="card card-body">
                  Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident.
                </div>
              </div>
        </div>
        <div class="row form-cadastro justify-content-center">
            <div class="col-10 align-self-center area-form">
                Area do formulario
              <!--Nome e sobrenome-->     
            <div class="row">  
              <div class="col">                            
                <div class="input-group mt-2">
                    <input type="text" id="nome" class="form-control bg-light" placeholder="Primeiro nome">
                </div>
              </div>
              <div class="col">
                <div class="input-group mt-2">
                    <input type="text" id="sobrenome" class="form-control bg-light" placeholder="Sobrenome">
                </div>
              </div>
            </div>
            <!--Sexo-->
            <div class="row">  
                <div class="col-1">                            
                  <div class="input-group mt-2">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="nmSexo" value="1" id="radioSexo">
                        <label class="form-check-label" for="flexRadioDefault1">
                          Feminino
                        </label>
                      </div>
                  </div>
                </div>
                <div class="col-2">
                  <div class="input-group mt-2">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="nmSexo" value="2" id="radioSexo">
                        <label class="form-check-label" for="flexRadioDefault1">
                          Masculino
                        </label>
                      </div>
                  </div>
                </div>
              </div>
                <!--CPF/CNPJ-->
                <div class="input-group mt-2">
                    <input type="text" id="cpf" class="form-control bg-light" placeholder="CPF/CNPJ">
                </div>
                  <!--RG-->
                <div class="input-group mt-2">
                    <input type="text" id="rg" class="form-control bg-light" placeholder="RG">
                </div>
                  <!--Data nascimento-->
                <div class="input-group mt-2">
                    <input type="text" id="dataNascimento" class="form-control bg-light" placeholder="Data Nascimento">
                </div>
                  <!--Estados e Cidade-->
                <div class="row">  
                    <div class="col-5">                            
                      <div class="input-group mt-2">
                        <select class="form-control" id="slIdEstado">
                            <option>Estado</option>
                          </select>
                      </div>
                    </div>
                    <div class="col-5">
                      <div class="input-group mt-2">
                        <select class="form-control" id="slIdCidade">
                            <option>Cidade</option>
                          </select>
                      </div>
                    </div>
                  </div>
                    <!--telefone-->
                  <div class="row">  
                    <div class="col-1">                            
                      <div class="input-group mt-2">
                        <label for="ddd"></label>
                        <input type="text" id="ddd" class="form-control" id="ddd" placeholder="DDD">
                      </div>
                    </div>
                    <div class="col-5">
                      <div class="input-group mt-2">
                        <label for="tel"></label>
                        <input type="text" id="tel" class="form-control" id="tel" placeholder="Telefone 00000-0000">
                      </div>
                    </div>
                    <!--celular-->
                    <div class="row">  
                        <div class="col-1">                            
                          <div class="input-group mt-2">
                            <label for="ddd"></label>
                            <input type="text" id="cddd"class="form-control" id="ddd" placeholder="DDD">
                          </div>
                        </div>
                        <div class="col-5">
                          <div class="input-group mt-2">
                            <label for="tel"></label>
                            <input type="text" id="cel" class="form-control" id="tel" placeholder="Celular 00000-0000">
                          </div>
                        </div>
                      </div>
                  </div>
                  <!--email-->
                  <div class="row">  
                    <div class="col">                            
                      <div class="input-group mt-2">
                          <input type="email" id="email"class="form-control bg-light" placeholder="@Email">
                      </div>
                    </div>
                  </div>
                  <div class="row">  
                    <div class="col-3">                            
                      <div class="input-group mt-2">
                          <input type="password" id="senha" class="form-control bg-light" placeholder="senha">
                      </div>
                    </div>
                    <div class="col-3">
                      <div class="input-group mt-2">
                          <input type="password" id="senhaConfirm" class="form-control bg-light" placeholder="Confirma senha">
                      </div>
                    </div>
                  </div>
                  <div class="row">  
                    <div class="col-6">                            
                      <div class="input-group mt-2">
                          <input type="text" id="login" class="form-control bg-light" placeholder="Login">
                      </div>
                    </div>
                  </div>
                <input type="button" id="btn-enviar" value ="Enviar" class="btnw btn-info btn-block mt-2">
                <!--<input type="button" id="btn-enviar2" value ="Enviar" class="btnw btn-info btn-block mt-2">-->
            </div>
        </div>
    </div>
</body>
</html>
<script>
  $(document).ready(function () {
        $.ajax({
            type: "get",
            url: "http://localhost:8052/api-util/estado",
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            success: function (obj) {
                if (obj != null) {
                    //var data = obj.data;
                    var selectbox = $('#slIdEstado');
                    selectbox.find('option').remove();
                    $('<option>').val(0).text("Estado").appendTo(selectbox);
                    $.each(obj, function (i, d) {
                        $('<option>').val(d.idestado).text(d.estado).appendTo(selectbox);
                    });
                }
            },
            error: function(erro){
                console.log('Aconteceu um erro');
                console.log(erro.responseText);
            }
        });
    });

    $( "#slIdEstado" ).change(function() {
        let id = $( "#slIdEstado" ).val();
        $.ajax({
            type: "get",
            url: "http://localhost:8052/api-util/cidade/"+id,
            dataType: 'json',
            contentType: "application/json; charset=utf-8",
            success: function (obj) {
                if (obj != null) {
                    var selectbox = $('#slIdCidade');
                    selectbox.find('option').remove();
                    $('<option>').val(0).text("Cidade").appendTo(selectbox);
                    $.each(obj, function (i, d) {
                        $('<option>').val(d.idcidade).text(d.cidade).appendTo(selectbox);
                    });
                }
            },
            error: function(erro){
                console.log('Aconteceu um erro');
                console.log(erro.responseText);
            }
        });
    });

  $( "#btn-enviar" ).click(function() {
     sendBeneficario();
    //getFormBeneficiario();
  });

  $( "#btn-enviar2" ).click(function() {
    $("#login").removeClass("form-control bg-light").addClass("form-control is-invalid");
  });

  $("#login").blur(function (){  
    getLogin();
  });  
  
  function validaLogin(lg){
     //----------------------------------------
     let login = $("#login").val();
        $.ajax({
            type: "get",
            url: url ="http://localhost:8052/api-util/login/"+login,
            dataType: 'text',
            contentType: "application/json; charset=utf-8",
            success: function (obj) {
                if(obj == 1){
                    $("#login").removeClass("form-control bg-light").addClass("form-control is-valid");
                }
                else{
                    $("#login").removeClass("form-control bg-light").addClass("form-control is-invalid");
                }
            },
            error: function(erro){
                console.log('Aconteceu um erro');
                console.log(erro.responseText);
            }
        });
  }

  function getLogin(){
    let login = $("#login").val();
    if(login != null){
        validaLogin(login);
    }
    else
     return;
  }

  function sendBeneficario(){
      let url = "http://localhost:8052/api-beneficiario/beneficiario";
      let benef = getFormBeneficiario();

      $.ajax({
        type:"POST",
        url:url,
        dataType: 'json',
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify(benef),
        success:function(result){
            alert("Sucesso!!");
        },
        error:function(err){
            console.log("erro");
            console.log(err.responseText);
        }
      });
  }

  function getBeneficiario(){
    var beneficario = {
        idlogin: {
            login: "wcirino",
            senha: "$2a$16$vxIpa5gXHch9r/RKRydFfuZNXeoKl5qSGCnEVsv9GxI3h1RfxGkHq",
            email: "Aliquam@ProindolorNulla.co.uk",
            ativo: "1",
    },
        nome_comp: "Willyan Fernando da Cruz Cirino",
        cpfcnpj: "96255367723",
        data_nasc: "2004-05-22T13:51:06.000+00:00",
        idestado: "4",
        telefone: "39-168010550",
        celular: "25-969819994",
        carteirinha: "AA5897216",
        sexo: "2",
        ativo: "1",
        rg: "7669065521314"
      };

      return beneficario;
  }

  function getFormBeneficiario(){
    var beneficario = {
        idlogin: {
            login: $("#login").val(),
            senha: $("#senha").val(),
            email: $("#email").val(),
            ativo: "1",
    },
        nome_comp: $("#nome").val(),
        cpfcnpj: $("#cpf").val(),
        data_nasc: "2004-05-22T13:51:06.000+00:00",
        idestado: $("#slIdEstado").val(),
        cidade: $("#slIdCidade").val(),
        telefone: $("#tel").val(),
        celular: $("#cel").val(),
        sexo: $("input[name='nmSexo']:checked").val(),
        ativo: "1",
        rg: $("#rg").val()
      };

      return beneficario;
  }
</script>